{% from 'govuk/components/date-input/macro.njk' import govukDateInput %}

{% macro date_input(idPrefix, labelText, validationResult, hintText) %}
  {% set classes_day = 'govuk-input--width-2' %}
  {% set classes_month = 'govuk-input--width-2' %}
  {% set classes_year = 'govuk-input--width-4' %}

  {% set dateErrorMessage = false %}
  {% set hasDateError = false %}

  {% if validationResult and validationResult.errors.length > 0 %}

    {% if validationResult.getErrorForField('day') %}
      {% set classes_day = classes_day + ' govuk-input--error' %}
      {% set hasDateError = true %}
    {% endif %}

    {% if validationResult.getErrorForField('month') %}
      {% set classes_month = classes_month + ' govuk-input--error' %}
      {% set hasDateError = true %}
    {% endif %}

    {% if validationResult.getErrorForField('year') %}
      {% set classes_year = classes_year + ' govuk-input--error' %}
      {% set hasDateError = true %}
    {% endif %}

    {% if validationResult.getErrorForField('date') %}
      {% set classes_day = classes_day + ' govuk-input--error' %}
      {% set classes_month = classes_month + ' govuk-input--error' %}
      {% set classes_year = classes_year + ' govuk-input--error' %}
      {% set hasDateError = true %}
    {% endif %}
  {% endif %}

  {% if hasDateError %}
    {% set errorMessages %}
      <ul style="padding: 0;list-style-type: none;">
        {% for error in validationResult.errors %}
          {% if error.field in ['day', 'month', 'year', 'date'] %}
            <li>
              {{ error.text }}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endset %}
  {% endif %}

  {% if errorMessages %}
    {% set dateErrorMessage = { html: errorMessages } %}
  {% endif %}

  {{
    govukDateInput ({
      id: idPrefix + '-date',
      fieldset: {
        legend: {
          text: labelText,
          isPageHeading: false,
          classes: 'govuk-fieldset__legend--s'
        }
      },
      hint: {
        text: hintText
      },
      errorMessage: dateErrorMessage,
      items: [
        {
          classes: classes_day,
          id: idPrefix + '-day',
          label: 'Day',
          name: 'day',
          value: day,
          autocomplete: 'off'
        },
        {
          classes: classes_month,
          id: idPrefix + '-month',
          label: 'Month',
          name: 'month',
          value: month,
          autocomplete: 'off'
        },
        {
          classes: classes_year,
          id: idPrefix + '-year',
          label: 'Year',
          name: 'year',
          value: year,
          autocomplete: 'off'
        }
      ]
    })
  }}

{% endmacro %}
